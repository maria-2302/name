<body></body>
<script>
var canvas = document.createElement("canvas");
document.body.style="display:flex; justify-content: center;";
var cxt = canvas.getContext("2d");
document.body.appendChild(canvas);
const width = canvas.width = 500;
const height = canvas.height = 500;

hero = new Image();
hero.src = "heroesheet.png";

map = new Image();
map.src = "images.jpg";

chest = new Image();
chest.src="chest.png";

object = new Image();
object.src = 'house.png'

fort1 = new Image()
fort1.src = 'forest1.png'
fort2 = new Image()
fort2.src = 'forest2.png'
fort3 = new Image()
fort3.src = 'forest3.png'



class tree{
   constructor(pic, x, y){
      this.img = pic;
      this.posx = x;
      this.posy = y;
   }
   draw(){
      cxt.drawImage(this.img, mx-this.posx, my-this.posy, 160,175)
   }}

dec1=new tree(fort1,-200,500)
dec2=new tree(fort2,-150,440)
dec3=new tree(fort3,800,100)
dec4=new tree(fort2,600,500)


class item{
   constructor(pic, x, y){
      this.img = pic;
      this.posx = x;
      this.posy = y;
   }
   draw(){
      cxt.drawImage(this.img, mx-this.posx, my-this.posy, 60,60)
   }}


class house{
   constructor(pic, x, y){
      this.img = pic;
      this.posx = x;
      this.posy = y;
   }
   draw(){
      cxt.drawImage(this.img, mx-this.posx, my-this.posy, 800,700)
      this.collision()
   }
   collision(){
   if ((this.posx - 190<mx)&
   (this.posx +190 > mx) &
   (this.posy - 235<my) &
   (this.posy + 235 > my))
        {
           console.log('conliss')
           mx -=1
           my -=1
        }
}}

home = new house(object,420,1000)



ch1 = new item(chest, -250,350)
ch2 = new item(chest, 275,700)
ch3 = new item(chest, 600,520)
var loot = [ch1, ch2,ch3]

const sprwidth = 95;
const sprheight = 105;
let Kadr = 0
let AnimLine = 4

let playframe = 0; //счётчик кадров
const slowframe = 15; //замедлитель

var mx = 100
var my = 600

//function collide(item){
//document.addEventListener('keydown', (event) => {
   //if ((event.key == 'e')&
   //   (item.posx + 235<mx)&
    //  (item.posx +265 > mx)&
   //   (item.posy + 235<my)&
    //  (item.posy +265 > my))

  // {console.log('catch!')
  // loot.splice(item, 1)}})

function collide(item){
   document.addEventListener('keydown',({keyCode})=>{
      switch(keyCode){
         case 69:
            if (
               (item.posx + 235<mx)&
               (item.posx +265 > mx)&
               (item.posy + 235<my)&
               (item.posy +265 > my))
         {loot.splice(item,1)
            }}
         })

   document.addEventListener('keyup', ({keyCode})=>{
      switch (keyCode){
         case 69:
         loot.splice(item,0)}})}


document.addEventListener('keydown', ({keyCode})=>{

   switch (keyCode){
   case 65: 
   AnimLine = 5; 
   mx += 5; 
   console.log("left", mx)
   break;

   case 68: 
   AnimLine = 7; 
   mx -= 5; 
   console.log("right", mx)
   break;

   case 83: 
   AnimLine = 4; 
   my -= 5; 
   console.log("davn :3",my)
   break;

   case 87: 
   AnimLine = 6; 
   my += 5; 
   console.log("yup:3",my)
   break;}})

document.addEventListener('keyup', ({keyCode})=>{

   switch (keyCode){
   case 65: 
   AnimLine = 1; 
   mx += 0; 
   console.log("left", mx)
   break;

   case 68: 
   AnimLine = 3; 
   mx -= 0; 
   console.log("right", mx)
   break;

   case 83: 
   AnimLine = 0; 
   my -= 0; 
   console.log("davn :3",my)
   break;

   case 87: 
   AnimLine = 2; 
   my += 0; 
   console.log("yup:3",my)
   break;}})

//function collide(item){
  // if(
   //document.addEventListener('keyup',({keyCode})=>{
   //switch (keyCode){
   //case 69: 
   //console.log('bib)')
   //break;}}) 
  // (item.posx + 235<mx)&
  // (item.posx +265 > mx)&
   //(item.posy + 235<my)&
   //(item.posy +265 > my))

   //{console.log('catch!')
   //loot.splice(item, 1)}}


function animate(){
   cxt.clearRect(0,0,width,height); 
   cxt.drawImage(map, mx-800,my-800,width+800,height+800 )
   cxt.drawImage(hero, Kadr*sprwidth, AnimLine*sprheight, sprwidth, sprheight, width/2, height/2,60,60);
   loot.forEach(elem => elem.draw())
   loot.forEach(elem => collide(elem))   
   home.draw()
   dec1.draw()
   dec2.draw()
   dec3.draw()
   dec4.draw()
   cxt.fillStyle = "#00F";
   cxt.strokeStyle = "#F00";
   cxt.font = "italic 14pt Times New Roman";
   cxt.fillText("Fill text", 20, 30);
   cxt.font = 'bold 30px sans-serif';
   if (playframe % slowframe == 0)
   {if (Kadr < 10)
   Kadr++;
   else Kadr = 0;}
   playframe++;
if((my<770) && (my>740)&&(mx>355)&&(mx<370)){
clearInterval(game)
console.log(123)
game2 = setInterval(animate2, 20)
mx-=100
my-=300}

   //requestAnimationFrame(animate); // перезапуск функции изнутри
}
//animate() //запуск функции снаружи
game = setInterval(animate, 20)

////////////////////////////////////////////////////////////////

map2 = new Image()
map2.src = 'interior2.png'


function animate2(){
   cxt.clearRect(0,0,width,height);  
   cxt.drawImage(map2, mx-550,my-550,width+550,height+550 )
   cxt.drawImage(hero, Kadr*sprwidth, AnimLine*sprheight, sprwidth, sprheight, width/2, height/2,60,60);
   cxt.fillStyle = "#00F";
   cxt.strokeStyle = "#F00";
   cxt.font = "italic 14pt Times New Roman";
   cxt.fillText("Fill text", 20, 30);
   cxt.font = 'bold 30px sans-serif';
  
   if (playframe % slowframe == 0)
   {if (Kadr < 10)
   Kadr++;
   else Kadr = 0;}
   playframe++;
   if((my<475) && (my>445)&&(mx>260)&&(mx<280)){
       console.log('exit')
    clearInterval(game2)
    game=setInterval(animate,20)
    mx+=100
    my+=300
}
}

//animate() //запуск функции снаружи

</script>